{"^":["class",{"#":["name","gluster::simple","params",{"#":["path",{"#":["value",""]},"volume",{"#":["value","puppet"]},"replica",{"#":["value",1]},"stripe",{"#":["value",1]},"layout",{"#":["value",""]},"vip",{"#":["value",""]},"vrrp",{"#":["value",false]},"password",{"#":["value",""]},"version",{"#":["value",""]},"repo",{"#":["value",true]},"count",{"#":["value",0]},"brick_params",{"#":["value",{"^":["hash"]}]},"brick_param_defaults",{"#":["value",{"^":["hash"]}]},"brick_params_defaults",{"#":["value",{"^":["array"]}]},"setgroup",{"#":["value",""]},"ping",{"#":["value",true]},"again",{"#":["value",true]},"baseport",{"#":["value",""]},"rpcauthallowinsecure",{"#":["value",false]},"shorewall",{"#":["value",true]}]},"body",[{"^":["invoke",{"#":["functor",{"^":["qn","include"]},"args",[{"^":["qn","gluster::vardir"]}]]}]},{"^":["invoke",{"#":["functor",{"^":["qn","include"]},"args",[{"^":["qn","gluster::volume::property::group::data"]}]]}]},{"^":["=",{"^":["var","vardir"]},{"^":["call",{"#":["functor",{"^":["qn","regsubst"]},"args",[{"^":["var","::gluster::vardir::module_vardir"]},"\\/$",""]]}]}]},{"^":["=",{"^":["var","chosen_path"]},{"^":["?",{"^":["concat",{"^":["str",{"^":["var","path"]}]}]},[{"^":["=>","",{"^":["concat",{"^":["str",{"^":["var","vardir"]}]},"/data/"]}]},{"^":["=>",{"^":["default"]},{"^":["concat",{"^":["str",{"^":["var","path"]}]}]}]}]]}]},{"^":["=",{"^":["var","valid_path"]},{"^":["call",{"#":["functor",{"^":["qn","sprintf"]},"args",["%s/",{"^":["call",{"#":["functor",{"^":["qn","regsubst"]},"args",[{"^":["var","chosen_path"]},"\\/$",""]]}]}]]}]}]},{"^":["=",{"^":["var","valid_volumes"]},{"^":["?",{"^":["call",{"#":["functor",{"^":["qn","type"]},"args",[{"^":["var","volume"]}]]}]},[{"^":["=>","array",{"^":["var","volume"]}]},{"^":["=>",{"^":["default"]},{"^":["array",{"^":["concat",{"^":["str",{"^":["var","volume"]}]}]}]}]}]]}]},{"^":["invoke",{"#":["functor",{"^":["qn","validate_hash"]},"args",[{"^":["var","brick_param_defaults"]}]]}]},{"^":["=",{"^":["var","areyousure"]},{"^":["hash",{"^":["=>","areyousure",true]}]}]},{"^":["=",{"^":["var","againhash"]},{"^":["hash",{"^":["=>","again",{"^":["var","again"]}]}]}]},{"^":["=",{"^":["var","valid_brick_param_defaults"]},{"^":["call",{"#":["functor",{"^":["qn","merge"]},"args",[{"^":["var","areyousure"]},{"^":["var","againhash"]},{"^":["var","brick_param_defaults"]}]]}]}]},{"^":["invoke",{"#":["functor",{"^":["qn","validate_array"]},"args",[{"^":["var","brick_params_defaults"]}]]}]},{"^":["=",{"^":["var","valid_brick_params_defaults"]},{"^":["var","brick_params_defaults"]}]},{"^":["resource",{"#":["type",{"^":["qn","notify"]},"bodies",[{"#":["title","gluster::simple","ops",[{"^":["=>","message","You are using gluster::simple !"]}]]}]]}]},{"^":["if",{"#":["test",{"^":["==",{"^":["concat",{"^":["str",{"^":["var","vip"]}]}]},""]},"then",[{"^":["invoke",{"#":["functor",{"^":["qn","warning"]},"args",["It is highly recommended to use a VIP."]]}]}]]}]},{"^":["resource",{"#":["type",{"^":["qn","class"]},"bodies",[{"#":["title","::gluster::server","ops",[{"^":["=>","vip",{"^":["concat",{"^":["str",{"^":["var","vip"]}]}]}]},{"^":["=>","vrrp",{"^":["var","vrrp"]}]},{"^":["=>","password",{"^":["concat",{"^":["str",{"^":["var","password"]}]}]}]},{"^":["=>","version",{"^":["concat",{"^":["str",{"^":["var","version"]}]}]}]},{"^":["=>","repo",{"^":["var","repo"]}]},{"^":["=>","baseport",{"^":["var","baseport"]}]},{"^":["=>","rpcauthallowinsecure",{"^":["var","rpcauthallowinsecure"]}]},{"^":["=>","shorewall",{"^":["var","shorewall"]}]}]]}]]}]},{"^":["if",{"#":["test",{"^":["==",{"^":["concat",{"^":["str",{"^":["var","::fqdn"]}]}]},""]},"then",[{"^":["invoke",{"#":["functor",{"^":["qn","fail"]},"args",["Your $fqdn is empty. Please check your DNS settings."]]}]}]]}]},{"^":["resource",{"#":["type",{"^":["qn","gluster::host"]},"bodies",[{"#":["title",{"^":["concat",{"^":["str",{"^":["var","::fqdn"]}]}]},"ops",[]]}],"form","exported"]}]},{"^":["collect",{"#":["type",{"^":["qr","Gluster::Host"]},"query",{"^":["exported-query"]}]}]},{"^":["invoke",{"#":["functor",{"^":["qn","validate_re"]},"args",[{"^":["concat",{"^":["str",{"^":["var","count"]}]}]},"^\\d+$"]]}]},{"^":["if",{"#":["test",{"^":["call",{"#":["functor",{"^":["qn","has_key"]},"args",[{"^":["var","brick_params"]},{"^":["concat",{"^":["str",{"^":["var","::fqdn"]}]}]}]]}]},"then",[{"^":["=",{"^":["var","brick_params_list"]},{"^":["access",{"^":["var","brick_params"]},{"^":["concat",{"^":["str",{"^":["var","::fqdn"]}]}]}]}]}],"else",[{"^":["=",{"^":["var","brick_params_list"]},{"^":["array"]}]}]]}]},{"^":["=",{"^":["var","brick_params_list_length"]},{"^":["call",{"#":["functor",{"^":["qn","inline_template"]},"args",["<%= @brick_params_list.length %>"]]}]}]},{"^":["=",{"^":["var","brick_params_defaults_length"]},{"^":["call",{"#":["functor",{"^":["qn","inline_template"]},"args",["<%= @valid_brick_params_defaults.length %>"]]}]}]},{"^":["=",{"^":["var","valid_count"]},{"^":["?",{"^":["concat",{"^":["str",{"^":["var","count"]}]}]},[{"^":["=>","0",{"^":["?",{"^":["concat",{"^":["str",{"^":["var","brick_params_list_length"]}]}]},[{"^":["=>","0",{"^":["?",{"^":["concat",{"^":["str",{"^":["var","brick_params_defaults_length"]}]}]},[{"^":["=>","0",1]},{"^":["=>",{"^":["default"]},{"^":["concat",{"^":["str",{"^":["var","brick_params_defaults_length"]}]}]}]}]]}]},{"^":["=>",{"^":["default"]},{"^":["concat",{"^":["str",{"^":["var","brick_params_list_length"]}]}]}]}]]}]},{"^":["=>",{"^":["default"]},{"^":["var","count"]}]}]]}]},{"^":["=",{"^":["var","brick_params_names"]},{"^":["?",{"^":["concat",{"^":["str",{"^":["var","valid_count"]}]}]},[{"^":["=>","1",{"^":["array",{"^":["concat",{"^":["str",{"^":["var","::fqdn"]}]},":",{"^":["str",{"^":["var","valid_path"]}]}]}]}]},{"^":["=>",{"^":["default"]},{"^":["call",{"#":["functor",{"^":["qn","split"]},"args",[{"^":["call",{"#":["functor",{"^":["qn","inline_template"]},"args",[{"^":["concat","<%= (1..@valid_count.to_i).collect{|i| '",{"^":["str",{"^":["var","::fqdn"]}]},":",{"^":["str",{"^":["var","valid_path"]}]},"brick' + i.to_s.rjust(7, '0') + '/' }.join(',') %>"]}]]}]},","]]}]}]}]]}]},{"^":["invoke",{"#":["functor",{"^":["qn","validate_array"]},"args",[{"^":["var","brick_params_list"]}]]}]},{"^":["=",{"^":["var","yaml"]},{"^":["call",{"#":["functor",{"^":["qn","inline_template"]},"args",["<%= (0..@valid_count.to_i-1).inject(Hash.new) { |h,i| {@brick_params_names[i] => (((i < @valid_brick_params_defaults.length) and @valid_brick_params_defaults[i].is_a?(Hash)) ? @valid_brick_params_defaults[i] : {}).merge((i < @brick_params_list.length) ? @brick_params_list[i] : {})}.merge(h) }.to_yaml %>"]]}]}]},{"^":["=",{"^":["var","hash"]},{"^":["call",{"#":["functor",{"^":["qn","parseyaml"]},"args",[{"^":["var","yaml"]}]]}]}]},{"^":["invoke",{"#":["functor",{"^":["qn","create_resources"]},"args",["@@gluster::brick",{"^":["var","hash"]},{"^":["var","valid_brick_param_defaults"]}]]}]},{"^":["collect",{"#":["type",{"^":["qr","Gluster::Brick"]},"query",{"^":["exported-query"]}]}]},{"^":["resource",{"#":["type",{"^":["qn","gluster::volume"]},"bodies",[{"#":["title",{"^":["var","valid_volumes"]},"ops",[{"^":["=>","replica",{"^":["var","replica"]}]},{"^":["=>","stripe",{"^":["var","stripe"]}]},{"^":["=>","layout",{"^":["concat",{"^":["str",{"^":["var","layout"]}]}]}]},{"^":["=>","bricks",true]},{"^":["=>","ping",{"^":["var","ping"]}]},{"^":["=>","start",true]},{"^":["=>","again",{"^":["var","again"]}]}]]}]]}]},{"^":["collect",{"#":["type",{"^":["qr","Gluster::Volume"]},"query",{"^":["exported-query"]}]}]},{"^":["if",{"#":["test",{"^":["!=",{"^":["concat",{"^":["str",{"^":["var","setgroup"]}]}]},""]},"then",[{"^":["=",{"^":["var","setgroup_yaml"]},{"^":["call",{"#":["functor",{"^":["qn","inline_template"]},"args",["<%= @valid_volumes.inject(Hash.new) { |h,i| {i+'#'+@setgroup => {}}.merge(h) }.to_yaml %>"]]}]}]},{"^":["=",{"^":["var","setgroup_hash"]},{"^":["call",{"#":["functor",{"^":["qn","parseyaml"]},"args",[{"^":["var","setgroup_yaml"]}]]}]}]},{"^":["=",{"^":["var","setgroup_defaults"]},{"^":["hash",{"^":["=>","vip",{"^":["concat",{"^":["str",{"^":["var","vip"]}]}]}]}]}]},{"^":["invoke",{"#":["functor",{"^":["qn","create_resources"]},"args",["gluster::volume::property::group",{"^":["var","setgroup_hash"]},{"^":["var","setgroup_defaults"]}]]}]}]]}]}]]}]}
